(this["webpackJsonpsimple-chat"]=this["webpackJsonpsimple-chat"]||[]).push([[0],{112:function(e,s,t){},114:function(e,s,t){},115:function(e,s,t){},116:function(e,s,t){},117:function(e,s,t){"use strict";t.r(s);var a=t(1),c=t.n(a),r=t(55),n=t.n(r),i=(t(61),t(3)),o=t(5),l=t(56),u=t.n(l)()("https://tranquil-reef-66373.herokuapp.com"),d=t(2),j=t.n(d),h=t(7),m=t(25),b=t(33),g=t.n(b),p=(t(112),t(0)),O=function(e){var s=e.className,t=e.register,a=e.placeholder,c=e.defaultValue,r=void 0===c?"":c,n=e.error,o=e.errorMsg,l=void 0===o?"":o;return Object(p.jsxs)("div",{class:"input-with-validate ".concat(n&&"with-error"," ").concat(s),children:[Object(p.jsx)("input",Object(i.a)({defaultValue:r,placeholder:a},t)),n&&Object(p.jsx)("div",{class:"input-with-validate__error",children:l})]})},_=function(e){var s=e.onLogin,t=(e.isLoading,e.setLoading),a=e.defaultName,r=c.a.useState(null),n=Object(o.a)(r,2),i=n[0],l=n[1],u=Object(m.a)(),d=u.register,b=u.handleSubmit,_=u.formState.errors,f=function(){var e=Object(h.a)(j.a.mark((function e(a){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l(null),t(!0),e.next=5,g.a.post("https://tranquil-reef-66373.herokuapp.com/rooms",a);case 5:return e.next=7,g.a.get("https://tranquil-reef-66373.herokuapp.com/rooms/1");case 7:c=e.sent,console.log("getData",c),s(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),l("This username already exists");case 15:return e.prev=15,t(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(s){return e.apply(this,arguments)}}();return Object(p.jsx)(p.Fragment,{children:Object(p.jsx)("div",{class:"entry-page",children:Object(p.jsxs)("form",{class:"entry-page__form",onSubmit:b(f),children:[Object(p.jsx)(O,{className:"entry-page__room-id",errorMsg:"Field required",error:_.roomId,placeholder:"Room id",register:d("roomId",{required:!0})}),Object(p.jsx)(O,{defaultValue:a,className:"entry-page__user-name",errorMsg:i,error:i,placeholder:"Your name",register:d("userName",{required:!0,maxLength:10})}),Object(p.jsx)("button",{className:"entry-page__btn",type:"submit",children:"entry"})]})})})},f=t(4),x=function(e,s){switch(s.type){case"SET_AUTH":return Object(i.a)(Object(i.a)(Object(i.a)({},e),s.payload),{},{isAuth:!0});case"SET_USERS":return Object(i.a)(Object(i.a)({},e),{},{users:s.users});case"SET_MESSAGES":return Object(i.a)(Object(i.a)({},e),{},{messages:s.messages});case"ADD_MSG":return Object(i.a)(Object(i.a)({},e),{},{messages:[].concat(Object(f.a)(e.messages),[s.msg])})}};t(114);var v=function(e){var s=e.loading,t=c.a.useState(!1),a=Object(o.a)(t,2),r=a[0],n=a[1],i=c.a.useRef(null),l=function(e){var s=c.a.useRef();return c.a.useEffect((function(){s.current=e})),s.current}(s);return c.a.useEffect((function(){!s&&l&&(n(!0),clearTimeout(i.current),i.current=setTimeout((function(){n(!1)}),300))}),[s,l]),Object(p.jsx)("div",{style:s||r?{display:"block"}:{display:"none"},className:"main-preloader ".concat(r&&"preloader-closing"),children:Object(p.jsx)("div",{className:"main-preloader__body",children:Object(p.jsx)("div",{className:"main-preloader__icon lds-dual-ring"})})})},S=(t(115),function(e){var s=e.userName,t=e.roomId,a=(e.isAuth,e.users),r=e.messages,n=c.a.useRef(null),o=Object(m.a)(),l=o.register,d=o.handleSubmit,j=o.reset;return c.a.useEffect((function(){n.current.scrollTop=n.current.scrollHeight}),[r]),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(v,{loading:!a.length}),Object(p.jsx)("div",{class:"chat-page",children:Object(p.jsxs)("div",{class:"chat-page__body",children:[Object(p.jsx)("header",{class:"chat-page__header",children:Object(p.jsxs)("h3",{class:"chat-page__room",children:["Room #",t]})}),Object(p.jsxs)("aside",{class:"chat-page__sidebar",children:[Object(p.jsxs)("span",{class:"chat-page__online",children:["Online: ",Object(p.jsx)("strong",{children:a.length})]}),Object(p.jsx)("div",{class:"chat-page__users-row",children:a.map((function(e,s){return Object(p.jsx)("div",{class:"chat-page__user",children:e},e+s)}))})]}),Object(p.jsx)("div",{class:"chat-page__dialog chat-dialog",children:Object(p.jsxs)("div",{class:"chat-dialog__body",children:[Object(p.jsx)("div",{ref:n,class:"chat-dialog__messages",id:"chat-msgs-body",children:Object(p.jsx)("div",{class:"chat-dialog__messages-body",children:r.map((function(e){return Object(p.jsxs)("div",{class:"chat-dialog__msg chat-msg ".concat((null===e||void 0===e?void 0:e.userName)==s?"my-msg":""),children:[Object(p.jsx)("span",{class:"chat-msg__name",children:null===e||void 0===e?void 0:e.userName}),Object(p.jsx)("span",{class:"chat-msg__text",children:null===e||void 0===e?void 0:e.text}),Object(p.jsx)("span",{class:"chat-msg__time",children:null===e||void 0===e?void 0:e.time})]})}))})}),Object(p.jsxs)("form",{onSubmit:d((function(e){console.log(e),u.emit("ROOM_NEW_MSG",{roomId:t,userName:s,text:e.message}),j()})),class:"chat-dialog__send-block",children:[Object(p.jsx)("input",Object(i.a)(Object(i.a)({},l("message",{required:!0})),{},{placeholder:"Your message",rows:"2",class:"chat-dialog__input"})),Object(p.jsx)("button",{type:"submit",class:"chat-dialog__send-btn",children:Object(p.jsx)("img",{src:"https://img.icons8.com/material-rounded/192/000000/filled-sent.png"})})]})]})})]})})]})}),y=(t(116),function(){var e=c.a.useState(!1),s=Object(o.a)(e,2),t=s[0],a=s[1],r=c.a.useReducer(x,{userName:null,roomId:null,isAuth:!1,users:[],messages:[]}),n=Object(o.a)(r,2),l=n[0],d=n[1];return c.a.useEffect((function(){u.on("ROOM_SET_USERS",(function(e){return d({type:"SET_USERS",users:e})})),u.on("ROOM_SET_ALL_DATA",(function(e){var s=e.users,t=e.messages;d({type:"SET_USERS",users:s}),d({type:"SET_MESSAGES",messages:t})})),u.on("ROOM_ADD_MSG",(function(e){return d({type:"ADD_MSG",msg:e})}))}),[]),Object(p.jsxs)("div",{className:"app",children:[Object(p.jsx)(v,{loading:t}),l.isAuth?Object(p.jsx)(S,Object(i.a)({},l)):Object(p.jsx)(_,{defaultName:l.userName,onLogin:function(e){d({type:"SET_AUTH",payload:e}),u.emit("ROOM_JOIN",e)},isLoading:t,setLoading:a})]})});n.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(y,{})}),document.getElementById("root"))},61:function(e,s,t){}},[[117,1,2]]]);
//# sourceMappingURL=main.59ed8224.chunk.js.map