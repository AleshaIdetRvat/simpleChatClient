(this["webpackJsonpsimple-chat"]=this["webpackJsonpsimple-chat"]||[]).push([[0],{112:function(e,s,t){},114:function(e,s,t){},115:function(e,s,t){},116:function(e,s,t){},117:function(e,s,t){"use strict";t.r(s);var a=t(1),c=t.n(a),r=t(54),n=t.n(r),i=(t(61),t(3)),l=t(5),o=t(55),u=t.n(o)()(),d=t(2),j=t.n(d),m=t(7),h=t(25),b=t(56),g=t.n(b),O=(t(112),t(0)),_=function(e){var s=e.className,t=e.register,a=e.placeholder,c=e.defaultValue,r=void 0===c?"":c,n=e.error,l=e.errorMsg,o=void 0===l?"":l;return Object(O.jsxs)("div",{class:"input-with-validate ".concat(n&&"with-error"," ").concat(s),children:[Object(O.jsx)("input",Object(i.a)({defaultValue:r,placeholder:a},t)),n&&Object(O.jsx)("div",{class:"input-with-validate__error",children:o})]})},p=function(e){var s=e.onLogin,t=(e.isLoading,e.setLoading),a=e.defaultName,r=c.a.useState(null),n=Object(l.a)(r,2),i=n[0],o=n[1],u=Object(h.a)(),d=u.register,b=u.handleSubmit,p=u.formState.errors,f=function(){var e=Object(m.a)(j.a.mark((function e(a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o(null),t(!0),e.next=5,g.a.post("/rooms",a);case 5:s(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),o("This username already exists");case 11:return e.prev=11,t(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})));return function(s){return e.apply(this,arguments)}}();return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)("div",{class:"entry-page",children:Object(O.jsxs)("form",{class:"entry-page__form",onSubmit:b(f),children:[Object(O.jsx)(_,{className:"entry-page__room-id",errorMsg:"Field required",error:p.roomId,placeholder:"Room id",register:d("roomId",{required:!0})}),Object(O.jsx)(_,{defaultValue:a,className:"entry-page__user-name",errorMsg:i,error:i,placeholder:"Your name",register:d("userName",{required:!0,maxLength:10})}),Object(O.jsx)("button",{className:"entry-page__btn",type:"submit",children:"entry"})]})})})},f=t(4),x=function(e,s){switch(s.type){case"SET_AUTH":return Object(i.a)(Object(i.a)(Object(i.a)({},e),s.payload),{},{isAuth:!0});case"SET_USERS":return Object(i.a)(Object(i.a)({},e),{},{users:s.users});case"SET_MESSAGES":return Object(i.a)(Object(i.a)({},e),{},{messages:s.messages});case"ADD_MSG":return Object(i.a)(Object(i.a)({},e),{},{messages:[].concat(Object(f.a)(e.messages),[s.msg])})}};t(114);var v=function(e){var s=e.loading,t=c.a.useState(!1),a=Object(l.a)(t,2),r=a[0],n=a[1],i=c.a.useRef(null),o=function(e){var s=c.a.useRef();return c.a.useEffect((function(){s.current=e})),s.current}(s);return c.a.useEffect((function(){!s&&o&&(n(!0),clearTimeout(i.current),i.current=setTimeout((function(){n(!1)}),300))}),[s,o]),Object(O.jsx)("div",{style:s||r?{display:"block"}:{display:"none"},className:"main-preloader ".concat(r&&"preloader-closing"),children:Object(O.jsx)("div",{className:"main-preloader__body",children:Object(O.jsx)("div",{className:"main-preloader__icon lds-dual-ring"})})})},S=(t(115),function(e){var s=e.userName,t=e.roomId,a=(e.isAuth,e.users),r=e.messages,n=c.a.useRef(null),l=Object(h.a)(),o=l.register,d=l.handleSubmit,j=l.reset;return c.a.useEffect((function(){n.current.scrollTop=n.current.scrollHeight}),[r]),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(v,{loading:!a.length}),Object(O.jsx)("div",{class:"chat-page",children:Object(O.jsxs)("div",{class:"chat-page__body",children:[Object(O.jsx)("header",{class:"chat-page__header",children:Object(O.jsxs)("h3",{class:"chat-page__room",children:["Room #",t]})}),Object(O.jsxs)("aside",{class:"chat-page__sidebar",children:[Object(O.jsxs)("span",{class:"chat-page__online",children:["Online: ",Object(O.jsx)("strong",{children:a.length})]}),Object(O.jsx)("div",{class:"chat-page__users-row",children:a.map((function(e,s){return Object(O.jsx)("div",{class:"chat-page__user",children:e},e+s)}))})]}),Object(O.jsx)("div",{class:"chat-page__dialog chat-dialog",children:Object(O.jsxs)("div",{class:"chat-dialog__body",children:[Object(O.jsx)("div",{ref:n,class:"chat-dialog__messages",id:"chat-msgs-body",children:Object(O.jsx)("div",{class:"chat-dialog__messages-body",children:r.map((function(e){return Object(O.jsxs)("div",{class:"chat-dialog__msg chat-msg ".concat((null===e||void 0===e?void 0:e.userName)==s?"my-msg":""),children:[Object(O.jsx)("span",{class:"chat-msg__name",children:null===e||void 0===e?void 0:e.userName}),Object(O.jsx)("span",{class:"chat-msg__text",children:null===e||void 0===e?void 0:e.text}),Object(O.jsx)("span",{class:"chat-msg__time",children:null===e||void 0===e?void 0:e.time})]})}))})}),Object(O.jsxs)("form",{onSubmit:d((function(e){console.log(e),u.emit("ROOM_NEW_MSG",{roomId:t,userName:s,text:e.message}),j()})),class:"chat-dialog__send-block",children:[Object(O.jsx)("input",Object(i.a)(Object(i.a)({},o("message",{required:!0})),{},{placeholder:"Your message",rows:"2",class:"chat-dialog__input"})),Object(O.jsx)("button",{type:"submit",class:"chat-dialog__send-btn",children:Object(O.jsx)("img",{src:"https://img.icons8.com/material-rounded/192/000000/filled-sent.png"})})]})]})})]})})]})}),y=(t(116),function(){var e=c.a.useState(!1),s=Object(l.a)(e,2),t=s[0],a=s[1],r=c.a.useReducer(x,{userName:null,roomId:null,isAuth:!1,users:[],messages:[]}),n=Object(l.a)(r,2),o=n[0],d=n[1];return c.a.useEffect((function(){u.on("ROOM_SET_USERS",(function(e){return d({type:"SET_USERS",users:e})})),u.on("ROOM_SET_ALL_DATA",(function(e){var s=e.users,t=e.messages;d({type:"SET_USERS",users:s}),d({type:"SET_MESSAGES",messages:t})})),u.on("ROOM_ADD_MSG",(function(e){return d({type:"ADD_MSG",msg:e})}))}),[]),Object(O.jsxs)("div",{className:"app",children:[Object(O.jsx)(v,{loading:t}),o.isAuth?Object(O.jsx)(S,Object(i.a)({},o)):Object(O.jsx)(p,{defaultName:o.userName,onLogin:function(e){d({type:"SET_AUTH",payload:e}),u.emit("ROOM_JOIN",e)},isLoading:t,setLoading:a})]})});n.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(y,{})}),document.getElementById("root"))},61:function(e,s,t){}},[[117,1,2]]]);
//# sourceMappingURL=main.9b3c5bfe.chunk.js.map